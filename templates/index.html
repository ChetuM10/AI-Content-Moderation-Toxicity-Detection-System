<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üõ°Ô∏è Toxicity Detection System</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- Animated Background -->
    <div class="bg-animation">
      <div class="circle circle-1"></div>
      <div class="circle circle-2"></div>
      <div class="circle circle-3"></div>
    </div>

    <!-- ====================================== -->
    <!-- AUTHENTICATION NAVIGATION BAR - NEW! -->
    <!-- ====================================== -->
    <nav class="auth-navbar glass-effect">
      <div class="nav-brand">
        <i class="fas fa-shield-alt"></i>
        <span>Senti-Clean</span>
      </div>

      <!-- User Menu (Shown when NOT logged in) -->
      <div class="nav-menu" id="guestMenu">
        <button class="nav-btn nav-btn-login" onclick="openLoginModal()">
          <i class="fas fa-sign-in-alt"></i>
          <span>Login</span>
        </button>
        <button class="nav-btn nav-btn-register" onclick="openRegisterModal()">
          <i class="fas fa-user-plus"></i>
          <span>Register</span>
        </button>
      </div>

      <!-- User Dashboard (Shown when logged in) -->
      <div class="nav-menu" id="userMenu" style="display: none">
        <div class="user-profile">
          <div class="user-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div class="user-info">
            <span class="user-name" id="userName">User</span>
            <span class="user-status">Premium</span>
          </div>
        </div>
        <button class="nav-btn nav-btn-history" onclick="toggleHistory()">
          <i class="fas fa-history"></i>
          <span>History</span>
        </button>
        <button class="nav-btn nav-btn-logout" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i>
          <span>Logout</span>
        </button>
      </div>
    </nav>

    <div class="container">
      <!-- Header Section -->
      <header class="header">
        <div class="logo">
          <i class="fas fa-shield-alt"></i>
        </div>
        <h1 class="title">Toxicity Detection System</h1>
        <p class="subtitle">
          AI-Powered Content Moderation with Toxic Word Reduction
        </p>
        <div class="tech-stack">
          <span class="tech-badge">Python</span>
          <span class="tech-badge">PyTorch</span>
          <span class="tech-badge">BERT</span>
          <span class="tech-badge">Flask</span>
        </div>
      </header>

      <!-- ====================================== -->
      <!-- ANALYSIS HISTORY PANEL - NEW! -->
      <!-- ====================================== -->
      <div
        class="history-panel glass-effect"
        id="historyPanel"
      >
        <div class="history-header">
          <h2><i class="fas fa-history"></i> Analysis History</h2>
          <button class="close-history-btn" onclick="toggleHistory()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="history-filters">
          <button class="filter-btn active" onclick="filterHistory('all')">
            <i class="fas fa-list"></i> All
          </button>
          <button class="filter-btn" onclick="filterHistory('toxic')">
            <i class="fas fa-exclamation-triangle"></i> Toxic
          </button>
          <button class="filter-btn" onclick="filterHistory('safe')">
            <i class="fas fa-check-circle"></i> Safe
          </button>
          <button class="filter-btn" onclick="filterHistory('favorites')">
            <i class="fas fa-star"></i> Favorites
          </button>
        </div>

        <div class="history-content" id="historyContent">
          <div class="history-loading">
            <div class="spinner"></div>
            <p>Loading history...</p>
          </div>
        </div>
      </div>

      <!-- Input Section -->
      <div class="input-section glass-effect">
        <div class="input-header">
          <i class="fas fa-keyboard"></i>
          <h2>Enter Text to Analyze</h2>
          <!-- Login Reminder for Anonymous Users -->
          <div class="login-reminder" id="loginReminder" style="display: none">
            <i class="fas fa-info-circle"></i>
            <span>Login to save your analysis history</span>
          </div>
        </div>
        <textarea
          id="textInput"
          placeholder="Type or paste your text here to analyze for toxic content..."
          rows="6"
        ></textarea>
        <div class="char-count" id="charCount">0 characters</div>

        <button id="analyzeBtn" class="analyze-btn" onclick="analyzeText()">
          <i class="fas fa-search"></i>
          <span>Analyze Text</span>
        </button>

        <!-- Example Buttons -->
        <div class="examples">
          <p class="examples-title">Quick Examples:</p>
          <button
            class="example-btn safe"
            onclick="setExample('I love this product! It works great!')"
          >
            <i class="fas fa-check-circle"></i> Positive
          </button>
          <button
            class="example-btn toxic"
            onclick="setExample('You Bastard! You worthless piece of garbage!')"
          >
            <i class="fas fa-exclamation-triangle"></i> Toxic
          </button>
          <button
            class="example-btn neutral"
            onclick="setExample('This is a neutral statement about technology.')"
          >
            <i class="fas fa-info-circle"></i> Neutral
          </button>
        </div>
      </div>

      <!-- PREMIUM FILE UPLOAD SECTION -->
      <section class="upload-section-premium">
        <div class="section-header">
          <div class="icon-wrapper">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
          </div>
          <div class="header-text">
            <h2>üìÅ Batch File Analysis</h2>
            <p>
              Upload .txt or .pdf files to analyze multiple texts simultaneously
            </p>
          </div>
        </div>

        <!-- Drag & Drop Zone -->
        <div class="upload-dropzone" id="dropzone">
          <input
            type="file"
            id="fileInput"
            accept=".txt,.pdf"
            style="display: none"
          />

          <div class="dropzone-content">
            <div class="upload-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="64"
                height="64"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
              >
                <path
                  d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2M7 9l5-5 5 5M12 4v12"
                ></path>
              </svg>
            </div>
            <h3>Drop your file here</h3>
            <p>or click to browse</p>
            <div class="file-types">
              <span class="badge badge-txt">.TXT</span>
              <span class="badge badge-pdf">.PDF</span>
            </div>
            <small>Maximum file size: 16 MB</small>
          </div>

          <div class="file-selected" id="fileSelected" style="display: none">
            <div class="file-info">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"
                ></path>
                <polyline points="13 2 13 9 20 9"></polyline>
              </svg>
              <div class="file-details">
                <strong id="selectedFileName">file.txt</strong>
                <span id="selectedFileSize">0 KB</span>
              </div>
            </div>
            <button class="btn-remove" onclick="removeFile()">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>

        <!-- Action Button -->
        <div class="upload-actions">
          <button
            onclick="uploadFile()"
            id="uploadBtn"
            class="btn-analyze"
            disabled
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="9 11 12 14 22 4"></polyline>
              <path
                d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"
              ></path>
            </svg>
            Analyze File
          </button>
        </div>

        <!-- Progress Indicator -->
        <div id="uploadProgress" class="upload-progress" style="display: none">
          <div class="progress-wrapper">
            <div class="spinner"></div>
            <p>Analyzing your file...</p>
          </div>
        </div>

        <!-- Results Section -->
        <div id="fileResults" class="results-container" style="display: none">
          <div class="results-header">
            <h3>üìä Analysis Results</h3>
            <button class="btn-export" onclick="exportResults()">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Export CSV
            </button>
          </div>

          <!-- Stats Cards -->
          <div id="fileStats" class="stats-grid"></div>

          <!-- Results Table -->
          <div class="table-wrapper">
            <div id="resultsTable"></div>
          </div>
        </div>
      </section>

      <!-- Loading Animation -->
      <div id="loading" class="loading" style="display: none">
        <div class="spinner"></div>
        <p>üîç Analyzing text with AI models...</p>
      </div>

      <!-- Error Message -->
      <div id="errorMessage" class="error-message" style="display: none"></div>

      <!-- Results Section -->
      <div id="results" class="results" style="display: none">
        <!-- Status Banner -->
        <div id="statusBanner" class="status-banner"></div>

        <!-- Text Comparison - Side by Side Layout -->
        <div class="text-comparison">
          <!-- Original Text Box -->
          <div class="text-box original-text-box">
            <h3>
              <i class="fas fa-exclamation-triangle"></i>
              Original Text
            </h3>
            <p id="displayOriginalText"></p>
          </div>

          <!-- Animated Arrow -->
          <div class="comparison-arrow">
            <i class="fas fa-arrow-right"></i>
            <span>AI POWERED</span>
          </div>

          <!-- Professional Rewrite Box -->
          <div class="text-box rewrite-box">
            <h3>
              <i class="fas fa-magic"></i>
              Professional Rewrite
            </h3>
            <p id="displayRewriteText"></p>
            <button class="copy-suggestion-btn" onclick="copySuggestion()">
              <i class="fas fa-copy"></i>
              Copy Suggestion
            </button>
          </div>
        </div>

        <!-- Sentiment Analysis Section - NEW! -->
        <div
          id="sentimentSection"
          class="sentiment-section glass-effect"
          style="display: none"
        ></div>

        <!-- Toxicity Scores -->
        <div class="scores-section glass-effect">
          <div class="section-header">
            <i class="fas fa-chart-bar"></i>
            <h2>Toxicity Analysis</h2>
          </div>
          <div id="scoresContainer"></div>
        </div>

        <!-- Flagged Categories -->
        <div
          id="flaggedSection"
          class="flagged-section"
          style="display: none"
        ></div>

        <!-- Toxic Words Section - NEW! -->
        <div
          id="toxicWordsSection"
          class="toxic-words-section glass-effect"
          style="display: none"
        ></div>

        <!-- Download Button -->
        <div class="actions">
          <button class="action-btn" onclick="downloadReport()">
            <i class="fas fa-download"></i> Download Report
          </button>
          <button class="action-btn secondary" onclick="copyResults()">
            <i class="fas fa-copy"></i> Copy Results
          </button>
          <!-- Favorite Button (Only for logged-in users) -->
          <button
            class="action-btn favorite-btn"
            id="favoriteBtn"
            onclick="toggleFavorite()"
            style="display: none"
          >
            <i class="fas fa-star"></i> Add to Favorites
          </button>
        </div>
      </div>

      <!-- Footer -->
      <footer class="footer">
        <p>
          Powered by BERT, RoBERTa & Detoxify | Built with
          <i class="fas fa-heart"></i> for Content Safety
        </p>
      </footer>
    </div>

    <!-- ====================================== -->
    <!-- LOGIN MODAL - NEW! -->
    <!-- ====================================== -->
    <div class="auth-modal" id="loginModal" style="display: none">
      <div class="modal-overlay" onclick="closeLoginModal()"></div>
      <div class="modal-content glass-effect">
        <div class="modal-header">
          <h2><i class="fas fa-sign-in-alt"></i> Login to Your Account</h2>
          <button class="modal-close" onclick="closeLoginModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form id="loginForm" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label for="loginEmail">
              <i class="fas fa-envelope"></i> Email Address
            </label>
            <input
              type="email"
              id="loginEmail"
              placeholder="Enter your email"
              required
            />
          </div>

          <div class="form-group">
            <label for="loginPassword">
              <i class="fas fa-lock"></i> Password
            </label>
            <input
              type="password"
              id="loginPassword"
              placeholder="Enter your password"
              required
            />
          </div>

          <button type="submit" class="btn-submit">
            <i class="fas fa-sign-in-alt"></i>
            <span>Login</span>
          </button>
        </form>

        <div class="modal-footer">
          <p>
            Don't have an account?
            <a href="#" onclick="switchToRegister()">Register here</a>
          </p>
        </div>
      </div>
    </div>

    <!-- ====================================== -->
    <!-- REGISTER MODAL - NEW! -->
    <!-- ====================================== -->
    <div class="auth-modal" id="registerModal" style="display: none">
      <div class="modal-overlay" onclick="closeRegisterModal()"></div>
      <div class="modal-content glass-effect">
        <div class="modal-header">
          <h2><i class="fas fa-user-plus"></i> Create New Account</h2>
          <button class="modal-close" onclick="closeRegisterModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form id="registerForm" onsubmit="handleRegister(event)">
          <div class="form-group">
            <label for="registerEmail">
              <i class="fas fa-envelope"></i> Email Address
            </label>
            <input
              type="email"
              id="registerEmail"
              placeholder="Enter your email"
              required
            />
          </div>

          <div class="form-group">
            <label for="registerPassword">
              <i class="fas fa-lock"></i> Password
            </label>
            <input
              type="password"
              id="registerPassword"
              placeholder="Minimum 8 characters"
              minlength="8"
              required
            />
          </div>

          <div class="form-group">
            <label for="registerPasswordConfirm">
              <i class="fas fa-lock"></i> Confirm Password
            </label>
            <input
              type="password"
              id="registerPasswordConfirm"
              placeholder="Re-enter your password"
              minlength="8"
              required
            />
          </div>

          <button type="submit" class="btn-submit">
            <i class="fas fa-user-plus"></i>
            <span>Create Account</span>
          </button>
        </form>

        <div class="modal-footer">
          <p>
            Already have an account?
            <a href="#" onclick="switchToLogin()">Login here</a>
          </p>
        </div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>
